(()=>{"use strict";const e="https://api.themoviedb.org/3/",t="33949e951ef79e9487d72ee006ef7f98",s="http://image.tmdb.org/t/p/",n=async e=>(await fetch(e)).json(),a=document.querySelector(".loader");async function o(){let a=[];const o=`${e}genre/movie/list?api_key=${t}&language=en-US&page=1`,i=await n(o),l=document.getElementById("movie-rows");l.innerHTML="",i.genres.forEach((async(o,r)=>{const c=`${e}discover/movie?api_key=${t}&with_genres=${o.id}&language=en-US&include_adult=false&page=1`,d=await n(c);a.push(d);let g=`<div class= 'movie-container'>\n    <div class = 'section-title'>${o.name}</div>\n    <div class="row"><span  class="arrow__btn left-arrow">‹</span>`;g+=d.results.map((e=>`<div class='card'><img class="movie-poster" loading="lazy" \n      src= '${s}w780${e.backdrop_path}' data-movieid=${e.id}>\n      <span class='movie-title'>${e.title}<span>\n      </div>`)),g+='<span  class="arrow__btn right-arrow">›</span></div> </div>',l.innerHTML+=g,r==i.genres.length-1&&Promise.all(a).then((e=>{m()}))}))}document.addEventListener("DOMContentLoaded",(()=>{g(),o()}));let i=0,l=0;var r=document.getElementsByClassName("search-box-icon")[0],c=document.getElementsByClassName("search-box")[0];let d=!1;r.addEventListener("click",(function(){c.classList.toggle("active")})),document.getElementById("search-movies").addEventListener("keyup",function(a,r){let c;return function(){c&&clearTimeout(c),c=setTimeout((()=>{!function(){let a=document.getElementById("search-movies").value;if(""==a)return d=!1,void o();const r=document.getElementById("movie-rows");r.innerHTML="",i=1,d=!0,g(),setTimeout((async()=>{try{const o=`${e}search/movie?api_key=${t}&language=en-US&query=${a}&include_adult=false&page=1`,i=await n(o);l=i.total_pages;let c,d="",g=0;for(;g<i.results.length;g++){let e="<div class= 'search-container'><div class=\"search-row\">";for(c=g;c<g+4;c++)e+=`<div class='card'><img  loading="lazy" src= '${s}w780${i.results[c].backdrop_path}' onerror="this.onerror=null; this.src='./img/No-Image.png'">\n          <span class='movie-title'>${i.results[c].title}<span>\n          </div>`;g=c-1,e+="</div></div>",d+=e}r.innerHTML=d,console.log(i)}catch(e){console.log(e.message)}finally{m()}}),1e3)}()}),2e3)}}());const m=()=>{a.classList.remove("show")},g=()=>{a.classList.add("show")};document.querySelector("#movie-rows").addEventListener("click",(e=>{const t=e.target;if(t.className="movie-poster"){const e=t.dataset.movieid;window.location.href=`/moviedetail.html?movie=${e}`}}));const u=document.getElementById("movie-rows");let v=new IntersectionObserver((function(a){a[0].intersectionRatio>0&&d&&u.hasChildNodes&&function(){const a=document.getElementById("movie-rows");let o=document.getElementById("search-movies").value;(0==l||i<l)&&(i++,g(),setTimeout((async()=>{try{const r=`${e}search/movie?api_key=${t}&language=en-US&query=${o}&include_adult=false&page=${i}`,c=await n(r);0==l&&(l=c.total_pages);let d,g="",u=0;for(;u<c.results.length;u++){let e="<div class= 'search-container'><div class=\"search-row\">";for(d=u;d<u+4;d++)e+=`<div class='card'><img loading="lazy" src= '${s}w780${c.results[d].backdrop_path}' onerror="this.onerror=null; this.src='./img/No-Image.png'">\n            <span class='movie-title'>${c.results[d].title}<span>\n            </div>`;u=d-1,e+="</div></div>",g+=e}a.innerHTML+=g,console.log(c)}catch(e){console.log(e.message)}finally{m()}}),1e3))}()}),{root:null,rootMargin:"0px",threshold:1}),h=document.querySelector("footer");v.observe(h)})();